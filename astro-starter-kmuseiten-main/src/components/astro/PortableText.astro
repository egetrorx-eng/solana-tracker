---
/**
 * Portable Text Renderer
 * ═══════════════════════════════════════════════════════════════
 * Renders Sanity Portable Text content with custom components.
 * Uses astro-portabletext for optimal performance.
 */

import { PortableText as AstroPortableText } from 'astro-portabletext';
import { urlFor } from '@/lib/sanity';

interface Props {
  value: unknown[];
  class?: string;
}

const { value, class: className = '' } = Astro.props;

// Custom components for Portable Text blocks
const components = {
  // Block styles
  block: {
    h2: 'h2',
    h3: 'h3',
    h4: 'h4',
    normal: 'p',
    blockquote: 'blockquote',
  },
  // Marks (inline styles)
  marks: {
    strong: 'strong',
    em: 'em',
    underline: 'u',
    link: ({ value, children }: any) => {
      const target = value?.blank ? '_blank' : undefined;
      const rel = value?.blank ? 'noopener noreferrer' : undefined;
      return `<a href="${value?.href}" target="${target}" rel="${rel}" class="text-primary-600 hover:text-primary-700 underline">${children}</a>`;
    },
  },
};
---

<div class:list={['portable-text prose prose-neutral max-w-none', className]}>
  <AstroPortableText value={value} components={components} />
</div>

<style>
  .portable-text :global(h2) {
    @apply text-2xl md:text-3xl font-semibold mt-8 mb-4 text-neutral-900;
  }

  .portable-text :global(h3) {
    @apply text-xl md:text-2xl font-semibold mt-6 mb-3 text-neutral-900;
  }

  .portable-text :global(h4) {
    @apply text-lg md:text-xl font-semibold mt-4 mb-2 text-neutral-900;
  }

  .portable-text :global(p) {
    @apply mb-4 leading-relaxed;
  }

  .portable-text :global(blockquote) {
    @apply border-l-4 border-primary-500 pl-4 italic my-6 text-neutral-600;
  }

  .portable-text :global(ul) {
    @apply list-disc list-inside mb-4 space-y-2;
  }

  .portable-text :global(ol) {
    @apply list-decimal list-inside mb-4 space-y-2;
  }

  .portable-text :global(img) {
    @apply rounded-lg my-6 w-full;
  }

  .portable-text :global(figure) {
    @apply my-6;
  }

  .portable-text :global(figcaption) {
    @apply text-sm text-neutral-500 mt-2 text-center;
  }
</style>

